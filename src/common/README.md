# 📁 Common Layer

**최하위 기반 레이어 - 모든 레이어에서 사용 가능한 순수 유틸리티**

## 🎯 역할과 책임

Common 레이어는 아키텍처의 **최하위 기반 레이어**로, 다음과 같은 역할을 담당합니다:

- **순수 함수 및 유틸리티** - 부작용이 없는 재사용 가능한 함수들
- **프레임워크 독립적 도구** - 특정 UI 프레임워크에 의존하지 않는 범용 함수
- **기본 타입 정의** - 애플리케이션 전반에서 사용되는 공통 타입
- **범용 상수** - 비즈니스 로직과 무관한 기술적 상수들

## 📦 레이어 구성 요소

### `/types`
**목적**: 프레임워크와 도메인에 독립적인 기본 타입 정의
- API 응답 형태, 정렬 옵션, 로딩 상태 등 범용 타입
- 제네릭 타입 정의 및 유틸리티 타입
- 프리미티브 타입의 확장 및 조합

### `/utils`
**목적**: 순수 함수 기반의 유틸리티 제공
- 배열, 객체, 문자열 조작 함수
- 데이터 변환 및 포맷팅 함수
- 수학적 계산 및 검증 함수
- 입출력이 예측 가능한 순수 함수들

### `/constants`
**목적**: 애플리케이션 전반에서 사용되는 기술적 상수
- HTTP 상태 코드, 에러 코드
- 정규 표현식 패턴
- 크기, 제한값 등의 기술적 설정값

### `/react` (선택적)
**목적**: React 관련 범용 유틸리티 (도메인 로직 제외)
- 디바운스, 쓰로틀링 등 성능 관련 훅
- 브라우저 API 추상화 훅
- 상태 관리와 무관한 UI 동작 훅

## 🔒 의존성 규칙

### ✅ 허용되는 의존성
- **내부 모듈**: Common 레이어 내의 다른 모듈
- **순수 유틸리티 라이브러리**: lodash, date-fns, ramda 등
- **최소한의 UI 프레임워크**: React 관련 유틸리티의 경우에만

### ❌ 금지되는 의존성
- **상위 레이어**: Global, Services, Shared, Domain, Feature, Routes
- **비즈니스 로직**: 도메인 특화 로직이나 업무 규칙
- **외부 시스템**: API 클라이언트, 데이터베이스 연결
- **상태 관리**: 전역 상태 관리 라이브러리

## 🏗️ 권장 폴더 구조

```
src/common/
├── index.ts              # Public API 정의
├── README.md            # 레이어 가이드 문서
├── types/               # 공통 타입 정의
├── utils/               # 순수 함수 유틸리티
├── constants/           # 기술적 상수
└── [framework]/         # 프레임워크별 유틸리티 (선택적)
```

## 📝 설계 원칙

### 순수성 원칙
- 모든 함수는 동일한 입력에 대해 동일한 출력을 보장
- 부작용(side effect) 없는 함수만 포함
- 외부 상태에 의존하지 않는 독립적인 동작

### 재사용성 원칙
- 특정 도메인에 종속되지 않는 범용적 기능
- 다양한 컨텍스트에서 활용 가능한 추상화 수준
- 설정이나 커스터마이징이 가능한 유연한 구조

### 안정성 원칙
- 변경 빈도가 낮은 안정적인 기능들
- 하위 호환성을 고려한 API 설계
- 의존성 변경이 상위 레이어에 영향을 주지 않음

## ⚠️ 주의사항과 안티패턴

### 금지사항
1. **도메인 로직 포함 금지**
   - 특정 비즈니스 규칙이나 업무 로직 구현
   - 사용자, 주문, 상품 등 도메인 개념에 종속적인 함수

2. **상위 레이어 의존성 금지**
   - 서비스, 컴포넌트, 상태 관리 모듈 참조
   - API 엔드포인트나 외부 시스템 연결

3. **부작용 있는 코드 금지**
   - 네트워크 요청, 파일 시스템 접근
   - 전역 상태 변경, DOM 조작
   - 로컬스토리지나 세션스토리지 직접 접근

### 올바른 추상화 수준
- **너무 구체적**: 특정 도메인에만 유용한 함수
- **너무 추상적**: 실제 사용하기 어려운 과도한 일반화
- **적절한 수준**: 여러 컨텍스트에서 유용하면서도 명확한 목적

## 🧪 품질 관리

### 테스트 전략
- **단위 테스트**: 모든 공개 함수에 대한 완전한 테스트
- **순수성 검증**: 동일 입력에 대한 동일 출력 보장
- **경계값 테스트**: 극단적인 입력값에 대한 동작 검증

### 품질 지표
- **테스트 커버리지**: 95% 이상
- **순수 함수 비율**: 100%
- **외부 의존성**: 최소화
- **성능**: 고빈도 사용 함수의 최적화

## 🎯 성공 기준

이 레이어가 성공적으로 설계되었다면:

1. **재사용률이 높음**: 여러 상위 레이어에서 광범위하게 사용
2. **변경 빈도가 낮음**: 안정적이고 성숙한 API 제공
3. **테스트가 쉬움**: 순수 함수로 인한 예측 가능한 동작
4. **의존성이 최소**: 외부 라이브러리에 대한 제한적 의존

이 레이어는 전체 아키텍처의 **신뢰할 수 있는 기반**이 되어야 합니다.